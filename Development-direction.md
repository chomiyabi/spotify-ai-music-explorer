# 開発方向性ドキュメント

## 開発フェーズの概要

本プロジェクトを7つのフェーズに分割し、段階的に機能を実装していきます。各フェーズで動作確認を行い、エラーを最小限に抑えながら開発を進めます。

---

## Phase 1: 基盤構築とSpotify API接続（基礎）
**目標**: Spotify APIとの接続を確立し、基本的なデータ取得を実現

### 実装内容
1. **Spotify API認証の実装**
   - Client Credentials Flowの実装
   - アクセストークンの取得・管理
   - トークンの自動更新機能

2. **基本的なAPIエンドポイントの作成**
   - `/api/auth/token` - トークン取得
   - `/api/test/search` - 検索機能のテスト

3. **エラーハンドリング**
   - API接続エラーの処理
   - レート制限への対応

### 成功基準
- Spotify APIからアクセストークンを取得できる
- 簡単な検索クエリでデータを取得できる
- コンソールにデータが正しく表示される

---

## Phase 2: フロントエンド基本UI構築
**目標**: ユーザーインターフェースの骨組みを作成

### 実装内容
1. **レイアウトコンポーネントの作成**
   - ヘッダーコンポーネント
   - メインコンテナー
   - フッター（必要に応じて）

2. **基本的なスタイリング**
   - CSSフレームワーク導入（Material-UI or Tailwind CSS）
   - レスポンシブデザインの基礎
   - カラーテーマの設定

3. **状態管理の準備**
   - Context APIまたはReduxの設定
   - ローディング状態の管理

### 成功基準
- 基本的なレイアウトが表示される
- レスポンシブデザインが機能する
- ローディング表示が動作する

---

## Phase 3: プリセットボタン機能（前半）
**目標**: 5つのプリセットボタンを実装し、基本的なデータ取得を実現

### 実装内容
1. **プリセットボタンコンポーネント**
   - ボタンUIの作成
   - クリックイベントの処理

2. **バックエンドAPIエンドポイント**
   - `/api/preset/viral-jp` - 日本のバイラル Top 50
   - `/api/preset/global-top` - 世界の Top 50
   - `/api/preset/artists-jp` - 日本の Top アーティスト
   - `/api/preset/new-releases` - 最新リリース
   - `/api/preset/playlists/workout` - ワークアウト向けプレイリスト

3. **データ取得と表示**
   - APIコールの実装
   - 基本的なリスト表示

### 成功基準
- 各ボタンをクリックしてデータが取得できる
- データがリスト形式で表示される
- エラー時に適切なメッセージが表示される

---

## Phase 4: 結果表示の高度化
**目標**: 取得したデータを魅力的に表示する

### 実装内容
1. **カード形式のコンポーネント**
   - 楽曲カード（画像、タイトル、アーティスト）
   - アーティストカード
   - プレイリストカード

2. **インタラクティブ要素**
   - ホバーエフェクト
   - クリックでSpotifyリンクを開く
   - プレビュー再生ボタン（可能な場合）

3. **ページネーション/無限スクロール**
   - 大量データの効率的な表示

### 成功基準
- カード形式で美しく情報が表示される
- Spotifyへの外部リンクが機能する
- スムーズなユーザー体験が提供される

---

## Phase 5: プリセットボタン機能（後半）
**目標**: 残り5つのプリセットボタンを実装

### 実装内容
1. **追加APIエンドポイント**
   - `/api/preset/artists-us` - アメリカの Top アーティスト
   - `/api/preset/kpop` - K-POP プレイリスト
   - `/api/preset/anime` - アニメソングプレイリスト
   - `/api/preset/new-singles` - 最新シングル
   - `/api/preset/podcasts` - ポッドキャストランキング

2. **データ種別に応じた表示調整**
   - ポッドキャスト用の表示形式
   - プレイリスト詳細表示

### 成功基準
- 全10個のプリセットボタンが機能する
- 各データタイプに適した表示形式が適用される

---

## Phase 6: AI検索機能の実装
**目標**: フリーテキスト検索とAI解釈機能を実装

### 実装内容
1. **検索UIコンポーネント**
   - テキスト入力フィールド
   - 検索ボタン
   - 検索履歴（オプション）

2. **Claude API統合**
   - `/api/ai/interpret` - テキスト解釈エンドポイント
   - プロンプトエンジニアリング
   - レスポンス解析

3. **AI結果からSpotify検索**
   - キーワード抽出
   - 適切なSpotify APIエンドポイントの選択
   - 検索実行と結果表示

### 成功基準
- 自然言語でのクエリが解釈される
- AI解釈結果に基づいて適切な検索が実行される
- 検索結果が正しく表示される

---

## Phase 7: 最終調整とデプロイ準備 ✅
**目標**: プロダクション環境への準備と最適化

### 実装内容
1. **パフォーマンス最適化**
   - React.memo・useCallback・useMemoによる最適化
   - 画像の遅延読み込み・スケルトンローダー
   - エラーバウンダリの実装

2. **SEO・PWA対応**
   - 完全なメタタグ・OGP設定
   - manifest.json PWA対応
   - アクセシビリティ WCAG 2.1 AA準拠

3. **本番環境設定**
   - 本番ビルドスクリプト設定
   - 環境変数の適切な管理
   - ヘルスチェック機能

4. **ドキュメント整備**
   - CLAUDE.md包括的ドキュメント作成
   - API仕様書・技術文書
   - セットアップ・デプロイ手順

### 成功基準 ✅
- 本番環境で安定して動作する
- エラー発生時に適切に処理される
- ドキュメントが整備されている
- PWA・SEO・アクセシビリティ対応完了

---

## Phase 8: Webサービス公開とデプロイ 🚀
**目標**: 実際のWebサービスとして誰でもアクセスできるように公開

### デプロイ戦略

#### 🌐 **フロントエンドデプロイ**
**推奨プラットフォーム**: Vercel（最適）
- **理由**: React・Next.js最適化、自動デプロイ、高速CDN
- **代替**: Netlify、GitHub Pages、Cloudflare Pages

**デプロイ手順**:
1. **Vercelアカウント作成・GitHub連携**
2. **プロジェクト設定**:
   ```
   Build Command: npm run build:prod
   Output Directory: build
   Install Command: npm install
   ```
3. **環境変数設定**: 
   - `REACT_APP_API_URL`: バックエンドURL
4. **独自ドメイン設定**: `spotify-ai-explorer.com`

#### ⚡ **バックエンドデプロイ**
**推奨プラットフォーム**: Railway（最適）
- **理由**: Node.js最適、環境変数管理、自動スケーリング
- **代替**: Render、Heroku、DigitalOcean App Platform

**デプロイ手順**:
1. **Railwayアカウント作成・GitHub連携**
2. **環境変数設定**:
   ```
   SPOTIFY_CLIENT_ID: [Spotifyアプリ設定]
   SPOTIFY_CLIENT_SECRET: [Spotifyアプリ設定]  
   CLAUDE_API_KEY: [Claude APIキー]
   PORT: 5001
   CLIENT_URL: https://spotify-ai-explorer.vercel.app
   NODE_ENV: production
   ```
3. **ビルドコマンド**: `npm run build:prod`
4. **起動コマンド**: `npm run start:prod`

#### 🔄 **CI/CD自動デプロイ設定**

**GitHub Actionsワークフロー**:
```yaml
name: Deploy to Production
on:
  push:
    branches: [ main ]

jobs:
  deploy-frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Deploy to Vercel
        uses: vercel/action@v1
        
  deploy-backend:
    runs-on: ubuntu-latest  
    steps:
      - uses: actions/checkout@v3
      - name: Deploy to Railway
        uses: railway/action@v1
```

### 📊 **本番環境監視**

#### **パフォーマンス監視**
- **Google PageSpeed Insights**: Core Web Vitals測定
- **Lighthouse**: PWA・SEO・アクセシビリティ監査
- **Vercel Analytics**: リアルタイムパフォーマンス

#### **エラー監視**  
- **Sentry**: JavaScript エラートラッキング
- **Railway Logs**: サーバーログ監視
- **Uptime Robot**: サービス稼働監視

### 🚀 **段階的リリース戦略**

#### **Phase 8.1: ベータ版公開**
- **URL**: `https://beta-spotify-ai-explorer.vercel.app`
- **対象**: 限定ユーザー・テスター
- **期間**: 1-2週間
- **目的**: バグ発見・パフォーマンス検証

#### **Phase 8.2: 正式版公開**
- **URL**: `https://spotify-ai-explorer.com`
- **対象**: 一般公開
- **機能**: 全機能解放
- **マーケティング**: SNS・プレスリリース

### 🔒 **セキュリティ・コンプライアンス**

#### **Spotify API利用規約準拠**
- **Design Guidelines**: Spotifyブランドガイドライン遵守
- **Rate Limiting**: 適切なAPI使用量管理
- **Attribution**: Spotify由来データの明記

#### **GDPR・プライバシー対応**
- **Cookie Policy**: 必要最小限のCookie使用
- **データ収集**: 匿名統計のみ
- **利用規約**: 明確なサービス利用条件

### 📈 **拡張計画**

#### **Phase 8.3: 機能拡張**
- **ユーザー登録・認証**: 個人化機能
- **プレイリスト保存**: お気に入り管理
- **ソーシャル機能**: 楽曲共有・レビュー
- **分析機能**: 音楽トレンド分析

#### **Phase 8.4: マネタイゼーション**
- **Spotify Premium**: アフィリエイト連携
- **広告収益**: Google AdSense統合
- **プレミアム機能**: 高度な検索・分析機能

### 💰 **運用コスト見積もり**

| サービス | 月額コスト | 用途 |
|---------|-----------|------|
| **Vercel Pro** | $20 | フロントエンドホスティング |
| **Railway** | $5-20 | バックエンドサーバー |
| **独自ドメイン** | $12/年 | spotify-ai-explorer.com |
| **Claude API** | $0-50 | AI検索機能（従量課金） |
| **監視ツール** | $0-30 | Sentry・分析ツール |
| **合計** | **$30-120/月** | **サービス規模により変動** |

### 🎯 **成功指標（KPI）**

#### **技術指標**
- **Core Web Vitals**: 全指標グリーン
- **PWA Score**: Lighthouse 90+点
- **アクセシビリティ**: WCAG 2.1 AA 100%準拠

#### **ビジネス指標**  
- **MAU**: 月間アクティブユーザー 1,000+
- **検索成功率**: AI検索成功率 85%+
- **ユーザー満足度**: Net Promoter Score 50+

### 📅 **デプロイスケジュール**

| 週 | タスク | 成果物 |
|---|--------|--------|
| **Week 1** | Vercel・Railway設定、ドメイン取得 | ベータ版URL |
| **Week 2** | 本番環境テスト、パフォーマンス調整 | 安定版デプロイ |
| **Week 3** | 監視設定、ドキュメント整備 | 運用体制構築 |
| **Week 4** | 正式公開、マーケティング開始 | 一般公開開始 |

### 🚦 **リスク管理**

#### **技術リスク**
- **Spotify API制限**: レート制限・サービス停止
- **対策**: キャッシュ機能・フォールバック実装

#### **運用リスク**
- **高トラフィック**: サーバー負荷対策
- **対策**: 自動スケーリング・CDN活用

#### **法的リスク**
- **著作権問題**: 音楽コンテンツ利用
- **対策**: Spotify API規約厳守・弁護士相談

---

## Phase 9: UX改善と機能修正 🎨
**目標**: ユーザビリティの向上と既存機能の改善

### 9.1: 検索結果の表示改善
**問題**: フィルター設定なしでは検索結果が表示されない
**解決策**: 
- デフォルトで人気度順の検索結果を表示
- フィルター機能をオプション化
- 初期表示時に全結果を人気度でソート

#### 実装内容:
1. **デフォルト表示設定**
   - 検索実行後、自動的に人気度降順でソート
   - フィルター未設定時も全件表示
   - ページネーション対応（20件/ページ）

2. **フィルターUI改善**
   - フィルターをアコーディオン形式に変更
   - 「フィルターを表示/非表示」トグルボタン追加
   - デフォルトで折りたたみ状態

### 9.2: 詳細ボタンの機能実装
**問題**: 曲一覧の「詳細」ボタンが機能していない
**解決策**: モーダルウィンドウで詳細情報を表示

#### 実装内容:
1. **詳細モーダルコンポーネント**
   - 楽曲の完全情報表示
   - アルバムアートワーク（大）
   - リリース日、長さ、BPM等のメタデータ
   - Spotifyで開くリンク
   - 関連アーティスト情報

2. **インタラクション改善**
   - スムーズなモーダル開閉アニメーション
   - ESCキーまたは外側クリックで閉じる
   - モバイル対応（フルスクリーン表示）

### 9.3: ランディングページとナビゲーション改善
**問題**: 全機能が1ページに集約されている
**解決策**: 2ページ構成に分離、検索結果をポップアップ表示

#### 実装内容:
1. **ページ構成の再設計**
   ```
   ページ1（ランディング）:
   - ウェルカムセクション
   - 特徴紹介（3カード）
   - 「探索を始める」CTAボタン
   
   ページ2（検索）:
   - プリセットボタングリッド
   - AI自然言語検索
   - 検索結果ポップアップ
   ```

2. **ナビゲーション実装**
   - React Routerによるページ遷移
   - スムーズなページ間アニメーション
   - ブラウザの戻る/進むボタン対応

3. **検索結果ポップアップ**
   - オーバーレイ形式で結果表示
   - 背景をぼかしエフェクト
   - 閉じるボタンとESCキー対応
   - 結果内でのスクロール可能

### 成功基準
- デフォルトで検索結果が表示される
- 詳細ボタンから楽曲詳細が確認できる
- ランディング→検索の流れが直感的
- モバイルでも快適に操作可能

---

## Phase 10: パフォーマンス最適化と追加機能 ⚡
**目標**: アプリケーションの高速化と便利機能の追加

### 10.1: パフォーマンス改善
1. **画像の最適化**
   - 遅延読み込み強化
   - WebP形式のサポート
   - サムネイルの事前生成

2. **検索結果のキャッシュ**
   - 同一検索のキャッシュ利用
   - IndexedDBによる永続化
   - キャッシュ有効期限管理

### 10.2: 追加機能
1. **検索履歴**
   - 最近の検索を保存
   - ワンクリックで再検索
   - 履歴のクリア機能

2. **お気に入り機能**
   - 楽曲をお気に入り登録
   - お気に入りリスト管理
   - LocalStorageに保存

3. **共有機能**
   - 検索結果のURL共有
   - SNSシェアボタン
   - QRコード生成

### 成功基準
- 初回ロード3秒以内
- 検索レスポンス1秒以内
- お気に入り機能が動作
- 共有URLから結果再現可能

---

## 各フェーズの推定作業時間

| Phase | 内容 | 推定時間 |
|-------|------|---------|
| Phase 1 | 基盤構築とSpotify API接続 | 2-3時間 |
| Phase 2 | フロントエンド基本UI構築 | 2-3時間 |
| Phase 3 | プリセットボタン機能（前半） | 3-4時間 |
| Phase 4 | 結果表示の高度化 | 3-4時間 |
| Phase 5 | プリセットボタン機能（後半） | 2-3時間 |
| Phase 6 | AI検索機能の実装 | 4-5時間 |
| Phase 7 | 最終調整とデプロイ準備 | 2-3時間 |
| Phase 8 | Webサービス公開とデプロイ | 2-3時間 |
| Phase 9 | UX改善と機能修正 | 4-6時間 |
| Phase 10 | パフォーマンス最適化と追加機能 | 3-4時間 |

**合計推定時間**: 27-38時間

---

## 開発における注意事項

### テスト戦略
- 各フェーズ完了時に手動テストを実施
- APIレスポンスのモックデータを準備
- エッジケースのテスト（空の結果、エラーレスポンス等）

### セキュリティ考慮事項
- APIキーをフロントエンドに露出させない
- CORS設定の適切な構成
- レート制限の実装

### スケーラビリティ
- 将来的な機能追加を考慮したコンポーネント設計
- APIエンドポイントの一貫性のある命名規則
- 状態管理の拡張性を確保

### デバッグとログ
- 開発環境での詳細なログ出力
- 本番環境では適切なログレベルの設定
- エラートラッキングツールの導入検討

---

## 次のアクション

**Phase 1から順番に実装を開始**
1. Spotify開発者アカウントでアプリケーションを登録
2. Client IDとClient Secretを取得して`.env`に設定
3. Phase 1の実装を開始